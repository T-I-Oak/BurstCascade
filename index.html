<!DOCTYPE html>
<html lang="ja">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>BURST CASCADE - 連鎖爆発ストラテジー</title>
    <link rel="stylesheet" href="burst_cascade/style.css">
</head>

<body>
    <div id="app">
        <header>
            <h1>BURST CASCADE <small
                    style="font-size: 0.7rem; opacity: 0.6; font-weight: 400; vertical-align: middle; margin-left: 0.5rem;">Ver
                    4.5.2</small></h1>
            <span id="help-btn">HOW TO PLAY</span>
            <div id="status-container">
                <div id="war-gauge-container">
                    <div id="p1-bar" class="gauge-bar" style="width: 50%;"></div>
                    <div id="p2-bar" class="gauge-bar" style="width: 50%;"></div>
                    <div id="p1-score" class="score-label">3</div>
                    <div id="p2-score" class="score-label">3</div>
                </div>
            </div>
        </header>
        <main>
            <canvas id="game-canvas"></canvas>
            <div id="overlay">
                <!-- タイトル・モード選択画面 -->
                <div id="mode-selection-content" class="modal-content">
                    <h1 class="title-logo">BURST CASCADE</h1>
                    <div class="version-badge">Ver 4.5.2</div>
                    <p class="subtitle">連鎖爆発ストラテジー</p>
                    <div class="menu-options">
                        <div class="settings-container">
                            <div class="setting-group">
                                <label>PLAYERS</label>
                                <div class="toggle-options" id="player-select">
                                    <button class="toggle-btn selected" data-value="pvc">1P <span class="sub">vs
                                            CPU</span></button>
                                    <button class="toggle-btn" data-value="pvp">2P <span
                                            class="sub">LOCAL</span></button>
                                </div>
                            </div>
                            <div class="setting-group" id="ai-level-group">
                                <label>AI LEVEL</label>
                                <div class="toggle-options" id="ai-level-select">
                                    <button class="toggle-btn" data-value="easy">EASY</button>
                                    <button class="toggle-btn selected" data-value="normal">NORMAL</button>
                                    <button class="toggle-btn" data-value="hard">HARD</button>
                                </div>
                            </div>
                            <div class="setting-group">
                                <label>MAP SIZE</label>
                                <div class="toggle-options" id="size-select">
                                    <button class="toggle-btn" data-value="mini">MINI</button>
                                    <button class="toggle-btn selected" data-value="regular">REGULAR</button>
                                </div>
                            </div>
                        </div>
                        <button id="game-start-btn" class="menu-btn primary large">GAME START</button>
                    </div>
                    <div class="menu-footer">
                        <span id="start-help-btn" class="footer-link">HOW TO PLAY</span>
                    </div>
                </div>

                <!-- ヘルプコンテンツ -->
                <div id="help-content" class="modal-content hidden">
                    <div class="help-scroll-container">
                        <section class="help-section">
                            <h2>Burst Cascade</h2>
                            <p class="flavor-text">
                                この世界は、純粋なエネルギーの結晶体「ヘキサグリッド」によって維持されてきた。しかし今、安定は崩れ、秩序は混沌へと向かっている。グリッドの不安定化は、一箇所の爆発（Burst）がさらなる事象を引き起こす連鎖（Cascade）を招き、既存の境界を飲み込もうとしている。
                            </p>
                            <p class="flavor-text">
                                あなたの使命は、この<strong>カスケード</strong>を戦略的に制御し、対立する勢力からすべての共鳴中枢（Core）を奪還することだ。グリッドのエネルギーを飽和させ、戦術的な爆発（Burst）を引き起こし、世界の秩序を再定義せよ。
                            </p>
                        </section>

                        <section class="help-section">
                            <h3>目的</h3>
                            <div class="tutorial-float-right">
                                <canvas id="help-core-canvas" class="tutorial-canvas" width="120" height="120"></canvas>
                                <p class="tutorial-caption">共鳴中枢（Core）</p>
                            </div>
                            <p>相手勢力がマップ中に保有している<strong>「共鳴中枢（Core）」</strong>をすべて<strong>無効化</strong>したら勝利となります。</p>
                            <ul class="help-list">
                                <li>相手のグリッドに自勢力の供給エネルギーを注入して中和したり、相手のグリッドを爆発（Burst）させることで、そこにある共鳴中枢（Core）を無効化することができます。
                                </li>
                            </ul>
                        </section>

                        <div style="clear: both;"></div>
                        <section class="help-section">
                            <h3>システム・ルール</h3>
                            <div class="rule-item">
                                <div class="tutorial-float-right">
                                    <canvas id="help-inject-canvas" class="tutorial-canvas" width="120"
                                        height="120"></canvas>
                                    <p class="tutorial-caption">エネルギー注入</p>
                                </div>
                                <h4>エネルギー注入プロセス</h4>
                                <p>ターン開始時、マップ中の自勢力のグリッドを選択して供給エネルギーを注入するプロセスです。</p>
                            </div>
                            <div class="rule-item">
                                <div class="tutorial-float-right">
                                    <canvas id="help-overload-canvas" class="tutorial-canvas" width="120"
                                        height="120"></canvas>
                                    <p class="tutorial-caption">爆発（Burst）</p>
                                </div>
                                <h4>爆発（Burst）</h4>
                                <p>エネルギー注入によってグリッドのポテンシャルが限界（エネルギー値9）を超えたときに発生します。</p>
                                <ul class="help-list">
                                    <li>蓄積されたエネルギーを放出し、グリッドは<strong>基底状態</strong>（0）へ戻ります。</li>
                                    <li>この時、そのグリッドに配置されていた共鳴中枢（Core）は<strong>無効化</strong>されます。</li>
                                </ul>
                            </div>
                            <div class="rule-item">
                                <h4>共鳴（Resonance）</h4>
                                <p>爆発（Burst）の発生に応じて得られる報酬です。</p>
                                <ul class="help-list">
                                    <li><strong>供給エネルギー強化</strong>:
                                        1ターン内に自勢力の爆発（Burst）が4回発生すると、供給エネルギーがランダムに1エネルギー強化されます。このとき、アクティブプレイヤーが交代します。
                                    </li>
                                    <li><strong>共鳴中枢（Core）追加</strong>:
                                        相手勢力の爆発（Burst）を通算で2回発生させるたびに、共鳴中枢（Core）がランダムに1つ増えます。</li>
                                </ul>
                            </div>
                            <div class="rule-item">
                                <div class="tutorial-float-right">
                                    <canvas id="help-reconstruct-canvas" class="tutorial-canvas" width="120"
                                        height="120"></canvas>
                                    <p class="tutorial-caption">供給エネルギー再構築</p>
                                </div>
                                <h4>供給エネルギーの再構築</h4>
                                <p>エネルギー注入後、7つの供給エネルギーのうちランダムな2つが選ばれ、再構築されます（±1 ずつ変化）。</p>
                                <ul class="help-list">
                                    <li><strong>爆発（Burst）未発生時 → 集束（Focus）</strong>:
                                        <br>エネルギー差が開くように移動します。<br>
                                        <small>（例: 2と4 → 1と5）</small>
                                    </li>
                                    <li><strong>爆発（Burst）発生時 → 拡散（Diffuse）</strong>:
                                        <br>エネルギー差が縮まるように移動します。<br>
                                        <small>（例: 1と5 → 2と4）</small>
                                    </li>
                                </ul>
                            </div>
                        </section>

                        <section class="help-section">
                            <h3>ターンの終了と継続</h3>
                            <p>行動の結果、次のターンの<strong>アクティブプレイヤー</strong>が決まります。</p>
                            <ul class="help-list">
                                <li><strong>停滞 (Stagnation)</strong>: <br>
                                    爆発（Burst）が発生しなかった場合。<br>
                                    → <strong>交代</strong>（相手がアクティブプレイヤーになります）</li>
                                <li><strong>飽和 (Saturation)</strong>: <br>
                                    供給エネルギー強化が発生した場合。<br>
                                    → <strong>交代</strong>（相手がアクティブプレイヤーになります）</li>
                                <li><strong>連鎖 (Cascade)</strong>: <br>
                                    爆発（Burst）が発生し、かつ飽和に至らなかった場合。<br>
                                    → <strong>継続</strong>（自分が引き続きアクティブプレイヤーとなります）</li>
                            </ul>
                        </section>

                    </div>
                    <button class="close-btn help-back-btn">タイトルに戻る</button>
                    <button id="help-close-btn" class="close-btn hidden">閉じる</button>
                </div>

                <!-- ゲームオーバー -->
                <div id="game-over-content" class="modal-content hidden">
                    <h2 id="winner-text">Player 1 Wins!</h2>
                    <p>Dominance established.</p>
                    <div class="menu-options">
                        <button id="restart-btn" class="menu-btn primary">TITLE SCREEN</button>
                    </div>
                </div>
            </div>

            <!-- 盤面覗き見ボタン (ホールドで非表示) -->
            <button id="peek-board-btn" class="overlay-toggle-btn hidden">HOLD TO VIEW</button>

            <!-- CPU思考中オーバーレイ（回路アニメーション用） -->
            <div id="ai-thinking-overlay" class="hidden">
                <div class="circuit-container">
                    <div class="circuit-core"></div>
                    <div class="circuit-path p1"></div>
                    <div class="circuit-path p2"></div>
                    <div class="circuit-path p3"></div>
                    <div class="circuit-text">ANALYZING CASCADE...</div>
                </div>
            </div>
        </main>
        <footer>
            <div id="controls">
                <!-- 将来的なコントロール用 -->
            </div>
        </footer>
    </div>
    <script src="burst_cascade/map.js"></script>
    <script src="burst_cascade/ai.js"></script>
    <script src="burst_cascade/main.js"></script>
    <script src="burst_cascade/tutorial.js"></script>
</body>

</html>
<!DOCTYPE html>
<html lang="ja">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>BURST CASCADE - 連鎖爆発ストラテジー</title>
    <link rel="stylesheet" href="burst_cascade/style.css?v=4.7.34">
    <link rel="stylesheet" href="burst_cascade/achievement_style.css?v=4.7.34">
</head>

<body>
    <div id="app">
        <header>
            <h1>BURST CASCADE</h1>
            <span id="help-btn">HOW TO PLAY</span>
            <div id="status-container">
                <div id="war-gauge-container">
                    <div id="p1-bar" class="gauge-bar" style="width: 50%;"></div>
                    <div id="p2-bar" class="gauge-bar" style="width: 50%;"></div>
                    <div id="p1-score" class="score-label">3</div>
                    <div id="p2-score" class="score-label">3</div>
                </div>
            </div>
        </header>
        <main>
            <canvas id="game-canvas"></canvas>
            <div id="overlay">
                <!-- タイトル・モード選択画面 -->
                <div id="mode-selection-content" class="modal-content">
                    <h1 class="title-logo">BURST CASCADE</h1>
                    <div class="version-badge">Ver 4.7.34</div>
                    <p class="subtitle">連鎖爆発ストラテジー</p>
                    <div class="menu-scroll-container">
                        <div class="menu-options">
                            <div class="settings-container">
                                <div class="setting-group" id="player-group">
                                    <label>PLAYERS</label>
                                    <div class="toggle-options" id="player-select">
                                        <button class="toggle-btn selected" data-value="pvc">1P <span class="sub">vs
                                                CPU</span></button>
                                        <button class="toggle-btn" data-value="pvp">2P <span
                                                class="sub">LOCAL</span></button>
                                    </div>
                                </div>
                                <div class="setting-group" id="ai-level-group">
                                    <label>AI LEVEL</label>
                                    <div class="toggle-options" id="ai-level-select">
                                        <button class="toggle-btn" data-value="easy">EASY</button>
                                        <button class="toggle-btn selected" data-value="normal">NORMAL</button>
                                        <button class="toggle-btn" data-value="hard">HARD</button>
                                    </div>
                                </div>
                                <div class="setting-group" id="size-group">
                                    <label>MAP SIZE</label>
                                    <div class="toggle-options" id="size-select">
                                        <button class="toggle-btn" data-value="mini">MINI</button>
                                        <button class="toggle-btn selected" data-value="regular">REGULAR</button>
                                    </div>
                                </div>
                                <div class="setting-group" id="sound-group">
                                    <label>SOUND / BGM</label>
                                    <div class="toggle-options" id="bgm-select">
                                        <button class="toggle-btn selected" data-value="on">ON</button>
                                        <button class="toggle-btn" data-value="off">OFF</button>
                                    </div>
                                </div>
                            </div>
                            <button id="game-start-btn" class="menu-btn primary large">GAME START</button>
                            <button id="achievements-btn" class="menu-btn secondary">ACHIEVEMENTS</button>
                        </div>
                        <div class="menu-footer">
                            <span id="start-help-btn" class="footer-link">HOW TO PLAY</span>
                        </div>
                    </div>
                </div>

                <!-- ヘルプコンテンツ -->
                <div id="help-content" class="modal-content hidden">
                    <div class="help-scroll-container">
                        <section class="help-section">
                            <h2>Burst Cascade</h2>
                            <p class="flavor-text">
                                この世界は、純粋なエネルギーの結晶体「ヘキサグリッド」によって維持されてきた。しかし今、安定は崩れ、秩序は混沌へと向かっている。グリッドの不安定化は、一箇所の爆発（Burst）がさらなる事象を引き起こす連鎖（Cascade）を招き、既存の境界を飲み込もうとしている。
                            </p>
                            <p class="flavor-text">
                                あなたの使命は、この<strong>カスケード</strong>を戦略的に制御し、対立する勢力からすべての共鳴中枢（Core）を奪還することだ。グリッドのエネルギーを飽和させ、戦術的な爆発（Burst）を引き起こし、世界の秩序を再定義せよ。
                            </p>
                        </section>

                        <section class="help-section">
                            <h3>目的</h3>
                            <div class="tutorial-float-right">
                                <canvas id="help-core-canvas" class="tutorial-canvas" width="120" height="120"></canvas>
                                <p class="tutorial-caption">共鳴中枢（Core）</p>
                            </div>
                            <p>相手勢力がマップ中に保有している<strong>「共鳴中枢（Core）」</strong>をすべて<strong>無効化</strong>したら勝利となります。</p>
                            <ul class="help-list">
                                <li>相手のグリッドに自勢力の供給エネルギーを注入して中和したり、相手のグリッドを爆発（Burst）させることで、そこにある共鳴中枢（Core）を無効化することができます。
                                </li>
                            </ul>
                        </section>

                        <div style="clear: both;"></div>
                        <section class="help-section">
                            <h3>システム・ルール</h3>
                            <p>このゲームは、<strong>「ターン」</strong>という単位で進行します。1つのターンは以下のフェーズのサイクルで構成されます。</p>
                            <ul class="help-list" style="margin-bottom: 20px;">
                                <li><strong>エネルギー注入フェーズ</strong>: エネルギー注入のアクションを行う段階です。</li>
                                <li><strong>供給エネルギー再構築フェーズ</strong>: アクションの結果を受け、供給エネルギーが変化する段階です。</li>
                                <li><strong>ターン継続チェックフェーズ</strong>: 次のターンに進むか、このターンのままアクションを続けるかを判定する段階です。</li>
                            </ul>

                            <div class="rule-item">
                                <div class="tutorial-float-right">
                                    <canvas id="help-inject-canvas" class="tutorial-canvas" width="120"
                                        height="120"></canvas>
                                    <p class="tutorial-caption">エネルギー注入</p>
                                </div>
                                <h4>1. エネルギー注入フェーズ</h4>
                                <p>自勢力のグリッドを選択してエネルギーを注入する<strong>アクション</strong>を行います。</p>
                                <ul class="help-list">
                                    <li>選択したグリッドを中心に、周囲を含む7つのグリッドに<strong>供給エネルギー</strong>が注入されます。</li>
                                    <li>供給エネルギー（どの位置にどれだけエネルギーが注入されるか）はマップの左上（Player 1）または右下（Player 2）に表示されます。</li>
                                    <li>エネルギーと同じ勢力のグリッドにエネルギーを注入した場合、その合計値がグリッドの新しいエネルギー値となります。</li>
                                    <li>エネルギーと異なる勢力のグリッドにエネルギーを注入した場合、その差分がグリッドの新しいエネルギー値となります。</li>
                                    <li>エネルギーを注入した結果により、爆発（Burst）や共鳴（Resonance）が発生します。</li>
                                </ul>
                            </div>

                            <div class="rule-item">
                                <div class="tutorial-float-right">
                                    <canvas id="help-overload-canvas" class="tutorial-canvas" width="120"
                                        height="120"></canvas>
                                    <p class="tutorial-caption">爆発（Burst）</p>
                                </div>
                                <h4>爆発（Burst）</h4>
                                <p>アクションによって注入されたエネルギーが限界（エネルギー値9）を超えたときに発生します。</p>
                                <ul class="help-list">
                                    <li>蓄積されたエネルギーを放出し、グリッドは<strong>基底状態</strong>（0）へ戻ります。</li>
                                    <li>そのグリッドに配置されていた共鳴中枢（Core）は<strong>無効化</strong>されます。</li>
                                </ul>
                            </div>

                            <div class="rule-item">
                                <h4>共鳴（Resonance）</h4>
                                <p>爆発（Burst）の発生回数に応じて発動する効果です。</p>
                                <ul class="help-list">
                                    <li><strong>供給エネルギー強化</strong>:
                                        1ターンの間に自勢力の爆発（Burst）を4回発生させると、供給エネルギーがランダムに1エネルギー強化されます。このとき、自動的に<strong>ターン終了</strong>となります。
                                    </li>
                                    <li><strong>共鳴中枢（Core）追加</strong>:
                                        相手勢力の爆発（Burst）を通算2回発生させるたびに、共鳴中枢（Core）がランダムに1つ増えます。（1ターン内で2回発生させる必要はありません）</li>
                                </ul>
                            </div>

                            <div class="rule-item">
                                <div class="tutorial-float-right">
                                    <canvas id="help-reconstruct-canvas" class="tutorial-canvas" width="120"
                                        height="120"></canvas>
                                    <p class="tutorial-caption">供給エネルギー再構築</p>
                                </div>
                                <h4>2. 供給エネルギー再構築フェーズ</h4>
                                <p>アクション終了後、7つの供給エネルギーのうちランダムな2つが選ばれ、再構築されます（±1 ずつ変化）。</p>
                                <ul class="help-list">
                                    <li><strong>爆発未発生時 → 集束（Focus）</strong>: エネルギー差が開くように移動します。
                                        <br><small>（例: 2と4 → 1と5）</small>
                                    </li>
                                    <li><strong>爆発発生時 → 拡散（Diffuse）</strong>: エネルギー差が縮まるように移動します。
                                        <br><small>（例: 1と5 → 2と4）</small>
                                    </li>
                                </ul>
                            </div>
                        </section>

                        <section class="help-section">
                            <h4>3. ターン継続チェックフェーズ</h4>
                            <p>爆発や共鳴の結果に応じて、次のターンに進むか、エネルギー注入フェーズに戻るかが確定します。</p>
                            <ul class="help-list">
                                <li><strong>停滞 (Stagnation)</strong>: 爆発（Burst）が発生しなかった場合。<br>
                                    → <strong>ターン終了（交代）</strong></li>
                                <li><strong>飽和 (Saturation)</strong>: 共鳴（Resonance）により供給エネルギー強化が発生した場合。<br>
                                    → <strong>ターン終了（交代）</strong></li>
                                <li><strong>連鎖 (Cascade)</strong>: 爆発（Burst）が発生し、かつ飽和に至らなかった場合。<br>
                                    → <strong>ターン継続（引き続き、エネルギー注入フェーズとしてアクションを行えます）</strong></li>
                            </ul>
                        </section>

                    </div>
                    <button id="help-bottom-back-btn" class="close-btn help-back-btn">RETURN TO TITLE</button>
                    <button id="help-close-btn" class="close-btn hidden">CLOSE</button>
                </div>

                <!-- 実績画面 (Ver 4.7.0) -->
                <div id="achievements-content" class="modal-content hidden">
                    <h2>ACHIEVEMENTS <span id="achievement-percent"
                            style="font-size: 0.6em; margin-left: 10px;">0%</span></h2>

                    <div class="tabs">
                        <button class="tab-btn" data-map="mini">MINI</button>
                        <button class="tab-btn active" data-map="regular">REGULAR</button>
                    </div>

                    <div class="achievements-scroll-container">
                        <table id="achievements-table">
                            <thead>
                                <tr>
                                    <th>ACHIEVEMENT</th>
                                    <th>EASY</th>
                                    <th>NORMAL</th>
                                    <th>HARD</th>
                                </tr>
                            </thead>
                            <tbody>
                                <!-- JSで動的に生成 -->
                            </tbody>
                        </table>
                    </div>

                    <div style="margin-top: 15px; display: flex; justify-content: space-between;">
                        <button id="achievement-reset-btn" class="debug-btn" style="opacity: 0.5;">DEBUG RESET</button>
                        <button id="achievements-back-btn" class="close-btn">RETURN TO TITLE</button>
                    </div>
                </div>

                <!-- ゲームオーバー -->
                <div id="game-over-content" class="modal-content hidden">
                    <h2 id="winner-text">Player 1 Wins!</h2>
                    <p>Dominance established.</p>
                    <div class="menu-options">
                        <button id="restart-btn" class="menu-btn primary">RETURN TO TITLE</button>
                    </div>
                </div>
            </div>

            <!-- 盤面覗き見ボタン (ホールドで非表示) -->
            <button id="peek-board-btn" class="overlay-toggle-btn hidden">PEEK BOARD</button>

            <!-- CPU思考中オーバーレイ（回路アニメーション用） -->
            <div id="ai-thinking-overlay" class="hidden">
                <div class="circuit-container">
                    <div class="circuit-core"></div>
                    <div class="circuit-path p1"></div>
                    <div class="circuit-path p2"></div>
                    <div class="circuit-path p3"></div>
                    <div class="circuit-text">ANALYZING CASCADE...</div>
                </div>
            </div>
        </main>
        <footer>
            <div id="controls">
                <!-- 将来的なコントロール用 -->
            </div>
        </footer>
    </div>
    <script src="burst_cascade/map.js?v=4.7.34"></script>
    <script src="burst_cascade/achievements.js?v=4.7.34"></script>
    <script src="burst_cascade/ai.js?v=4.7.34"></script>
    <script src="burst_cascade/main.js?v=4.7.34"></script>
    <script src="burst_cascade/tutorial.js?v=4.7.34"></script>
</body>

</html>